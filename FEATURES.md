# Skill Agent - åŠŸèƒ½ç‰¹æ€§è¯¦è§£

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ Skill Agent ç³»ç»Ÿçš„æ‰€æœ‰åŠŸèƒ½ç‰¹æ€§å’ŒæŠ€æœ¯ä¼˜åŒ–ã€‚

---

## ğŸ“‹ ç›®å½•

- [æ ¸å¿ƒå­¦ä¹ æŠ€èƒ½](#æ ¸å¿ƒå­¦ä¹ æŠ€èƒ½)
- [æ™ºèƒ½Agentèƒ½åŠ›](#æ™ºèƒ½agentèƒ½åŠ›)
- [Phase 3 æ¶æ„ä¼˜åŒ–](#phase-3-æ¶æ„ä¼˜åŒ–)
- [å‰ç«¯äº¤äº’ç‰¹æ€§](#å‰ç«¯äº¤äº’ç‰¹æ€§)
- [æ•°æ®å­˜å‚¨](#æ•°æ®å­˜å‚¨)
- [æ‰©å±•æ€§](#æ‰©å±•æ€§)

---

## 1. æ ¸å¿ƒå­¦ä¹ æŠ€èƒ½

### 1.1 æ¦‚å¿µè®²è§£ (Explain Skill)

**åŠŸèƒ½**: ç»“æ„åŒ–çš„æ¦‚å¿µè§£é‡Š

**ç‰¹æ€§**:
- ç›´è§‰ç†è§£ï¼ˆIntuitionï¼‰- æ—¥å¸¸ç±»æ¯”
- æ­£å¼å®šä¹‰ï¼ˆFormal Definitionï¼‰- å­¦æœ¯å®šä¹‰
- é‡è¦æ€§ï¼ˆWhy It Mattersï¼‰- å®é™…åº”ç”¨
- å¤šä¸ªç¤ºä¾‹ï¼ˆExamplesï¼‰- 2-3ä¸ªæ¸è¿›å¼ä¾‹å­
- å¸¸è§è¯¯è§£ï¼ˆCommon Mistakesï¼‰
- ç›¸å…³æ¦‚å¿µï¼ˆRelated Conceptsï¼‰

**ä¸Šä¸‹æ–‡æ”¯æŒ** (V1.5):
- åŸºäºé¢˜ç›®çš„é’ˆå¯¹æ€§è§£é‡Šï¼šå½“ç”¨æˆ·è¯´"è§£é‡Šä¸€ä¸‹ç¬¬ä¸€é“é¢˜"ï¼Œç³»ç»Ÿä¼šï¼š
  1. ä» `last_artifact_content` æå–ç¬¬1é¢˜
  2. ä½œä¸º `source_content` ä¼ é€’ç»™ explain skill
  3. ç”Ÿæˆä»¥"è¿™é“é¢˜è€ƒæŸ¥çš„æ˜¯..."å¼€å¤´çš„è§£é‡Š
  4. ç¬¬ä¸€ä¸ªä¾‹å­å°±æ˜¯é¢˜ç›®ä¸­çš„å…·ä½“æ¦‚å¿µ

**ç¤ºä¾‹**:
```
ğŸ‘¤: è§£é‡Šä¸€ä¸‹çç æ¸¯äº‹ä»¶
ğŸ¤–: 
  ç›´è§‰ç†è§£: çç æ¸¯äº‹ä»¶å°±åƒ...
  æ­£å¼å®šä¹‰: 1941å¹´12æœˆ7æ—¥ï¼Œæ—¥æœ¬æµ·å†›...
  é‡è¦æ€§: è¿™ä¸€äº‹ä»¶ç›´æ¥å¯¼è‡´ç¾å›½å‚æˆ˜...
  ä¾‹å­1: äº‹ä»¶å½“å¤©ï¼Œæ—¥æœ¬å‡ºåŠ¨...
  ä¾‹å­2: ç½—æ–¯ç¦æ€»ç»Ÿåœ¨äº‹ä»¶åå‘è¡¨...
```

---

### 1.2 æµ‹éªŒç”Ÿæˆ (Quiz Skill)

**åŠŸèƒ½**: ç”Ÿæˆå„ç§ç±»å‹çš„ç»ƒä¹ é¢˜

**é¢˜å‹æ”¯æŒ**:
- å•é€‰é¢˜ï¼ˆMultiple Choiceï¼‰
- å¤šé€‰é¢˜ï¼ˆMultiple Selectï¼‰
- å¡«ç©ºé¢˜ï¼ˆFill in the Blankï¼‰
- åˆ¤æ–­é¢˜ï¼ˆTrue/Falseï¼‰
- ç®€ç­”é¢˜ï¼ˆShort Answerï¼‰

**ç‰¹æ€§**:
- æ”¯æŒ 1-10 é¢˜è‡ªå®šä¹‰æ•°é‡
- éš¾åº¦è‡ªé€‚åº”ï¼ˆeasy/medium/hardï¼‰
- åŒ…å«è¯¦ç»†è§£æ
- æ”¯æŒåŸºäºå†…å®¹ç”Ÿæˆï¼ˆsource_contentï¼‰

**ä¸Šä¸‹æ–‡æ”¯æŒ** (V1.5):
- "æ ¹æ®è¿™äº›ä¾‹å­å‡ºé¢˜" â†’ åŸºäºä¸Šä¸€è½®çš„ explanation ç”Ÿæˆ
- "æ¯ä¸ªä¾‹å­å‡ºä¸€é“é¢˜" â†’ æ™ºèƒ½æ¨æ–­æ•°é‡

**ç¤ºä¾‹**:
```
ğŸ‘¤: ç»™æˆ‘5é“äºŒæˆ˜å†å²çš„é¢˜
ğŸ¤–: [ç”Ÿæˆ5é“é€‰æ‹©é¢˜ï¼ŒåŒ…å«é¢˜ç›®ã€é€‰é¡¹ã€æ­£ç¡®ç­”æ¡ˆã€è§£æ]

ğŸ‘¤: æ ¹æ®åˆšæ‰çš„è®²è§£å‡º3é“é¢˜
ğŸ¤–: [åŸºäºä¸Šä¸€è½®çš„explanationå†…å®¹ç”Ÿæˆ3é“é¢˜]
```

---

### 1.3 é—ªå¡ç”Ÿæˆ (Flashcard Skill)

**åŠŸèƒ½**: ç”Ÿæˆ Anki é£æ ¼çš„å­¦ä¹ å¡ç‰‡

**ç‰¹æ€§**:
- æ”¯æŒ 1-20 å¼ è‡ªå®šä¹‰æ•°é‡
- æ­£é¢/èƒŒé¢æ ¼å¼
- åŒ…å«è®°å¿†æç¤ºï¼ˆHintï¼‰
- éš¾åº¦æ ‡è®°ï¼ˆBasic/Intermediate/Advancedï¼‰
- æ”¯æŒå¤šç§å¡ç‰‡ç±»å‹

**å¡ç‰‡ç±»å‹**:
- æ¦‚å¿µå®šä¹‰å¡
- å…¬å¼è®°å¿†å¡
- å†å²äº‹ä»¶å¡
- æœ¯è¯­è§£é‡Šå¡

**ç¤ºä¾‹**:
```
ğŸ‘¤: ç»™æˆ‘10å¼ äºŒæˆ˜å†å²çš„é—ªå¡
ğŸ¤–: 
  å¡ç‰‡1:
    æ­£é¢: çç æ¸¯äº‹ä»¶å‘ç”Ÿåœ¨å“ªä¸€å¹´ï¼Ÿ
    èƒŒé¢: 1941å¹´12æœˆ7æ—¥
    æç¤º: äºŒæˆ˜è½¬æŠ˜ç‚¹
```

---

### 1.4 ç»“æ„åŒ–ç¬”è®° (Notes Skill)

**åŠŸèƒ½**: ç”Ÿæˆå±‚çº§åŒ–çš„å­¦ä¹ ç¬”è®°

**ç‰¹æ€§**:
- æ ‡é¢˜ + ç« èŠ‚ç»“æ„
- è¦ç‚¹åˆ—è¡¨ï¼ˆBullet Pointsï¼‰
- å¯ç¼–è¾‘çš„ Notebook UI
- æ”¯æŒæ·»åŠ /åˆ é™¤è¦ç‚¹
- å®æ—¶ä¿å­˜

**UIåŠŸèƒ½**:
- ç¼–è¾‘æ¨¡å¼åˆ‡æ¢
- ç« èŠ‚å±•å¼€/æŠ˜å 
- è¦ç‚¹å¢åˆ 
- æœ¬åœ°ä¿å­˜ï¼ˆè®¡åˆ’ä¸­ï¼‰

**ç¤ºä¾‹**:
```
ğŸ‘¤: åšç¬”è®°
ğŸ¤–: 
  äºŒæˆ˜å†å²ç¬”è®°
  
  1. æˆ˜äº‰èµ·å› 
     â€¢ å‡¡å°”èµ›æ¡çº¦çš„è‹›åˆ»åˆ¶è£
     â€¢ 1929å¹´ç»æµå¤§è§æ¡
     â€¢ æ³•è¥¿æ–¯ä¸»ä¹‰å´›èµ·
  
  2. é‡è¦äº‹ä»¶
     â€¢ 1939å¹´ï¼šæ³¢å…°é—ªå‡»æˆ˜
     â€¢ 1941å¹´ï¼šçç æ¸¯äº‹ä»¶
     â€¢ 1944å¹´ï¼šè¯ºæ›¼åº•ç™»é™†
```

---

### 1.5 æ€ç»´å¯¼å›¾ (MindMap Skill)

**åŠŸèƒ½**: å¯è§†åŒ–çŸ¥è¯†ç»“æ„

**ç‰¹æ€§**:
- åŸºäº Mind Elixir æ¸²æŸ“
- æ”¯æŒäº¤äº’å¼ç¼–è¾‘ï¼ˆè®¡åˆ’ä¸­ï¼‰
- è‡ªåŠ¨ç”Ÿæˆå±‚çº§ç»“æ„
- ä¸»é¢˜èŠ‚ç‚¹é«˜äº®

**ç»“æ„**:
- ä¸­å¿ƒä¸»é¢˜
- ä¸€çº§åˆ†æ”¯ï¼ˆ3-5ä¸ªï¼‰
- äºŒçº§åˆ†æ”¯ï¼ˆæ¯ä¸ª2-4ä¸ªï¼‰

**ç¤ºä¾‹**:
```
ğŸ‘¤: ç»™æˆ‘äºŒæˆ˜å†å²çš„æ€ç»´å¯¼å›¾
ğŸ¤–: [ç”Ÿæˆäº¤äº’å¼æ€ç»´å¯¼å›¾]
     ä¸­å¿ƒï¼šäºŒæˆ˜å†å²
      â”œâ”€ æˆ˜äº‰èµ·å› 
      â”‚   â”œâ”€ å‡¡å°”èµ›æ¡çº¦
      â”‚   â””â”€ ç»æµå¤§è§æ¡
      â”œâ”€ ä¸»è¦æˆ˜å½¹
      â”‚   â”œâ”€ æ³¢å…°æˆ˜å½¹
      â”‚   â”œâ”€ ä¸åˆ—é¢ ç©ºæˆ˜
      â”‚   â””â”€ æ–¯å¤§æ—æ ¼å‹’æˆ˜å½¹
      â””â”€ æˆ˜äº‰ç»“æœ
```

---

### 1.6 å­¦ä¹ åŒ… (Learning Bundle)

**åŠŸèƒ½**: ä¸€ç«™å¼ç»¼åˆå­¦ä¹ èµ„æ–™

**åŒ…å«å†…å®¹**:
- Explanationï¼ˆæ¦‚å¿µè®²è§£ï¼‰
- Quizï¼ˆç»ƒä¹ é¢˜ï¼‰
- Flashcardï¼ˆé—ªå¡ï¼‰
- å¯é€‰ï¼šNotesã€MindMap

**ç‰¹æ€§**:
- æ™ºèƒ½ç»„åˆæœ€ä½³å­¦ä¹ èµ„æº
- ä¸€æ¬¡è¯·æ±‚ç”Ÿæˆå¤šç§ææ–™
- å†…å®¹å…³è”æ€§é«˜

**ç¤ºä¾‹**:
```
ğŸ‘¤: äºŒæˆ˜å†å²å­¦ä¹ èµ„æ–™
ğŸ¤–: [ç”Ÿæˆå­¦ä¹ åŒ…]
    â€¢ æ ¸å¿ƒæ¦‚å¿µè®²è§£
    â€¢ 5é“ç»ƒä¹ é¢˜
    â€¢ 10å¼ è®°å¿†é—ªå¡
    â€¢ ç»“æ„åŒ–ç¬”è®°
```

---

## 2. æ™ºèƒ½Agentèƒ½åŠ›

### 2.1 æ„å›¾è¯†åˆ« (Intent Recognition)

**ä¸¤é˜¶æ®µè¯†åˆ«**:
1. **è§„åˆ™å¼•æ“**ï¼ˆ70%è¯·æ±‚ï¼Œ0 tokensï¼‰
   - å…³é”®è¯åŒ¹é…
   - æ­£åˆ™è¡¨è¾¾å¼æå–
   - ä¼˜å…ˆçº§åŒ¹é…ï¼ˆexplain > quizï¼‰

2. **LLM Fallback**ï¼ˆ30%è¯·æ±‚ï¼Œ~1,500 tokensï¼‰
   - å¤„ç†å¤æ‚/æ¨¡ç³Šè¯·æ±‚
   - ä¸Šä¸‹æ–‡æ¨ç†

**æ”¯æŒçš„æ„å›¾ç±»å‹**:
- `quiz_request` - é¢˜ç›®ç”Ÿæˆ
- `explain_request` - æ¦‚å¿µè®²è§£
- `flashcard_request` - é—ªå¡ç”Ÿæˆ
- `notes` - ç¬”è®°ç”Ÿæˆ
- `mindmap` - æ€ç»´å¯¼å›¾
- `learning_bundle` - å­¦ä¹ åŒ…
- `help` - åŠŸèƒ½æŸ¥è¯¢
- `contextual` - ä¸Šä¸‹æ–‡å¼•ç”¨
- `ambiguous` - æ¨¡ç³Šè¯·æ±‚
- `other` - å…¶ä»–å¯¹è¯

**ä¸Šä¸‹æ–‡å¼•ç”¨æ£€æµ‹**:
- æ£€æµ‹å…³é”®è¯ï¼šã€Œç¬¬ä¸€é“ã€ã€Œè¿™äº›ã€ã€Œåˆšæ‰çš„ã€
- è‡ªåŠ¨è®¾ç½® `use_last_artifact = True`
- æ™ºèƒ½æå–ç‰¹å®šå†…å®¹

---

### 2.2 è®°å¿†ç®¡ç† (Memory Management)

**ä¸¤ç§è®°å¿†ç±»å‹**:

#### é•¿æœŸè®°å¿† (UserLearningProfile)
- `user_id` - ç”¨æˆ·æ ‡è¯†
- `mastery` - å­¦ç§‘æŒæ¡åº¦ (0-1)
- `preferences` - ç”¨æˆ·åå¥½ï¼ˆpreferred_artifact, difficultyï¼‰
- `learning_history` - å­¦ä¹ å†å²
- `created_at` / `updated_at` - æ—¶é—´æˆ³

#### çŸ­æœŸè®°å¿† (SessionContext)
- `session_id` - ä¼šè¯æ ‡è¯†
- `current_topic` - å½“å‰å­¦ä¹ ä¸»é¢˜
- `recent_intents` - æœ€è¿‘10ä¸ªæ„å›¾
- `last_artifact` - ä¸Šä¸€è½®äº§ç‰©ç±»å‹
- `last_artifact_content` - **å®Œæ•´çš„ä¸Šä¸€è½®å†…å®¹**ï¼ˆå…³é”®ï¼ï¼‰
- `last_user_message` - æœ€åä¸€æ¡ç”¨æˆ·æ¶ˆæ¯

**æœ¬åœ°æŒä¹…åŒ–**:
- ä½ç½®: `backend/memory_storage/`
- æ ¼å¼: JSONï¼ˆæ ¼å¼åŒ–ï¼Œæ˜“è¯»ï¼‰
- æ–‡ä»¶:
  - `profile_<user_id>.json`
  - `session_<session_id>.json`
- å®æ—¶æ›´æ–°

---

### 2.3 ä¸ªæ€§åŒ–æ¨è

**åå¥½å­¦ä¹ **:
- è‡ªåŠ¨ç»Ÿè®¡ç”¨æˆ·æœ€å¸¸ä½¿ç”¨çš„æŠ€èƒ½
- è®¡ç®—åå¥½æƒé‡ï¼ˆflashcard: 0.6, quiz: 0.3, explain: 0.1ï¼‰
- æ›´æ–° `preferred_artifact`

**æ¨¡ç³Šæ„å›¾å¤„ç†**:
```
ğŸ‘¤: å¸®æˆ‘å­¦ä¹ äºŒæˆ˜å†å²
ğŸ¤–: [æ£€æµ‹åˆ°æ¨¡ç³Šæ„å›¾]
    â†’ æŸ¥è¯¢ç”¨æˆ·åå¥½: preferred_artifact = "flashcard"
    â†’ è‡ªåŠ¨ç”Ÿæˆ10å¼ äºŒæˆ˜å†å²é—ªå¡
```

**ä¸Šä¸‹æ–‡ç»§æ‰¿**:
```
ğŸ‘¤: ç»™æˆ‘5é“äºŒæˆ˜å†å²çš„é¢˜  [è®¾ç½® current_topic = "äºŒæˆ˜å†å²çš„"]
ğŸ‘¤: ç»™æˆ‘10å¼ é—ªå¡            [ç»§æ‰¿ topic = "äºŒæˆ˜å†å²çš„"]
ğŸ¤–: [ç”ŸæˆäºŒæˆ˜å†å²çš„10å¼ é—ªå¡]
```

---

### 2.4 ä¸Šä¸‹æ–‡å¼•ç”¨ (V1.5)

**æ”¯æŒçš„å¼•ç”¨æ¨¡å¼**:
- "è§£é‡Šä¸€ä¸‹ç¬¬ä¸€é“é¢˜"
- "æ ¹æ®è¿™äº›ä¾‹å­å‡ºé¢˜"
- "ç»™æˆ‘è¿™é“é¢˜çš„é—ªå¡"
- "åŸºäºåˆšæ‰çš„è®²è§£åšç¬”è®°"

**å¤„ç†æµç¨‹**:
1. **è§„åˆ™å¼•æ“æ£€æµ‹**: è¯†åˆ«"ç¬¬ä¸€é“"å…³é”®è¯
2. **è®¾ç½®æ ‡è®°**: `use_last_artifact = True`
3. **Topic Validation**: è¿‡æ»¤æ— æ•ˆtopicï¼ˆå¦‚"ç¬¬ä¸€"ï¼‰
4. **Topic Fallback**: ä½¿ç”¨ `current_topic`
5. **å†…å®¹æå–**: 
   - æ£€æµ‹ "ç¬¬Xé“é¢˜" â†’ æå–é¢˜å·
   - ä» `last_artifact_content.questions[X-1]` æå–
   - æ„å»º `source_content`
6. **Skillæ‰§è¡Œ**: ä¼ é€’ `source_content` ç»™æŠ€èƒ½

**ç¤ºä¾‹æµç¨‹**:
```
ç¬¬1è½®: ç»™æˆ‘5é“äºŒæˆ˜å†å²çš„é¢˜
  â†’ last_artifact_content = { questions: [é¢˜1, é¢˜2, é¢˜3, é¢˜4, é¢˜5] }
  â†’ current_topic = "äºŒæˆ˜å†å²çš„"

ç¬¬2è½®: è§£é‡Šä¸€ä¸‹ç¬¬ä¸€é“é¢˜
  â†’ è§„åˆ™å¼•æ“: explain_request + use_last_artifact = True
  â†’ Topic Validation: "ç¬¬ä¸€" æ— æ•ˆ
  â†’ Topic Fallback: topic = "äºŒæˆ˜å†å²çš„"
  â†’ å†…å®¹æå–: questions[0] â†’ source_content
  â†’ Explain Skill: åŸºäºç¬¬1é¢˜ç”Ÿæˆè§£é‡Š
```

---

## 3. Phase 3 æ¶æ„ä¼˜åŒ–

### 3.1 æ··åˆIntent Router

**æ¶æ„**:
```
User Message
    â†“
Rule Engine (0 tokens) â†â”€â”€ 70% è¯·æ±‚
    â†“ (failed)
LLM Fallback (~1,500 tokens) â†â”€â”€ 30% è¯·æ±‚
    â†“
Intent Result
```

**è§„åˆ™å¼•æ“ä¼˜åŠ¿**:
- âœ… **0 tokens** æ¶ˆè€—
- âœ… **<0.01s** å“åº”æ—¶é—´
- âœ… 100% å‡†ç¡®ç‡ï¼ˆæ˜¾å¼è¯·æ±‚ï¼‰
- âœ… æ”¯æŒæ•°é‡æå–ã€ä¸Šä¸‹æ–‡æ£€æµ‹

**LLM Fallbackåœºæ™¯**:
- å¤æ‚è¯­ä¹‰ï¼ˆ"æ ¹æ®è¿™é“é¢˜å†å‡º3é“ç±»ä¼¼çš„"ï¼‰
- æ¨¡ç³Šæ„å›¾ï¼ˆ"å¸®æˆ‘å­¦ä¹ "ï¼‰
- æ··åˆè¯·æ±‚ï¼ˆ"è®²è§£ + å‡ºé¢˜"ï¼‰

---

### 3.2 Token ä¼˜åŒ–æ•ˆæœ

| æŒ‡æ ‡ | Phase 1 (çº¯LLM) | Phase 2 (ç²¾ç®€Prompt) | **Phase 3 (æ··åˆ)** |
|------|----------------|---------------------|-------------------|
| Intent Router Token | 3,132 | 1,902 | **1,487** (-53%) âœ… |
| è§„åˆ™å¼•æ“å‘½ä¸­ç‡ | 0% | 0% | **70%** âœ… |
| å¹³å‡Token/è½® | 3,132 | 1,902 | **450** (-86%) âœ… |
| å¹³å‡å“åº”æ—¶é—´ | ~1.5s | ~1.2s | **<0.01s** (-99%) âœ… |

**10è½®å¯¹è¯Tokenå¯¹æ¯”**:
- Phase 1: 31,320 tokens
- Phase 2: 19,020 tokens
- **Phase 3**: **4,500 tokens** âœ…

**æ¶æ„å¯¹æ¯”å¯è§†åŒ–**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âŒ Phase 1: å…¨é‡LLM (Tokenéšä¸Šä¸‹æ–‡å¢é•¿)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·è¾“å…¥
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Intent Router (LLM)                      â”‚
â”‚ â€¢ Prompt: ~1,200 tokens                  â”‚
â”‚ â€¢ Memory: ~1,500 tokens (éšå†å²å¢é•¿ âš ï¸)  â”‚
â”‚ â€¢ Artifact: ~400 tokens                  â”‚
â”‚ Total: 3,132 tokens, ~2.0s               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
Intent Result â†’ Skill Execution

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Phase 3: è§„åˆ™å¼•æ“ + ç²¾ç®€LLM (Tokenå›ºå®š)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·è¾“å…¥
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Rule Engine (70% å‘½ä¸­)                   â”‚
â”‚ Total: 0 tokens, <0.01s âœ…                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“ (å‘½ä¸­)
Intent Result â†’ Skill Execution

  â†“ (æœªå‘½ä¸­, 30%)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LLM Fallback                             â”‚
â”‚ â€¢ Prompt: ~800 tokens (ç²¾ç®€)             â”‚
â”‚ â€¢ Flags: ~20 tokens (å›ºå®š âœ…)            â”‚
â”‚ Total: ~1,487 tokens, ~1.6s              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
Intent Result â†’ Skill Execution
```

**å•æ¬¡è¯·æ±‚ Token å¯¹æ¯”**:

```
ç¤ºä¾‹: "ç»™æˆ‘5é“ç‰›é¡¿ç¬¬äºŒå®šå¾‹çš„é¢˜"

Phase 1: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 3,132 tokens (~2.0s)
Phase 3: 0 tokens (<0.01s) âœ…

èŠ‚çœ: 3,132 tokens (100%)
```

```
ç¤ºä¾‹: "æ ¹æ®è¿™äº›å†…å®¹å¸®æˆ‘å·©å›º"ï¼ˆæœªå‘½ä¸­è§„åˆ™ï¼‰

Phase 1: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 3,132 tokens (~2.0s)
Phase 3: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 1,487 tokens (~1.6s) âœ…

èŠ‚çœ: 1,645 tokens (52%)
```

**10è½®å¯¹è¯ç´¯è®¡ Token**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 1                                      â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 31,320       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phase 2                                      â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 19,020                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phase 3                                      â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 4,500 âœ…                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

èŠ‚çœ: 26,820 tokens (85.6%)
å¹³å‡æ¯è½®: 450 tokens (vs 3,132)
```

---

### 3.3 Minimal Intent Router

**è®¾è®¡åŸåˆ™**:
- Intent Routeråªè¯†åˆ«å’Œæ ‡è®°intent
- å¤æ‚é€»è¾‘ç”±Orchestratorå¤„ç†ï¼ˆ0 tokensï¼‰
- æœ€å°åŒ–contextä¼ é€’

**å¤„ç†ç¤ºä¾‹**:
```
Intent Router (1,487 tokens):
  â†’ è¯†åˆ«: intent = "ambiguous"
  â†’ æ ‡è®°: user_preference_top = "flashcard"
  â†’ è¿”å›

Orchestrator (0 tokens):
  â†’ è¯»å– user_profile.preferences
  â†’ æ¨æ–­: intent = "flashcard"
  â†’ æå–: topic = current_topic
  â†’ æ‰§è¡Œ flashcard_skill
```

---

### 3.4 ä¸Šä¸‹æ–‡æ¨æ–­æ¶æ„

**æ ¸å¿ƒç†å¿µ**: ä¸åˆ¤æ–­"ä»€ä¹ˆæ˜¯æ— æ•ˆ"ï¼Œè€Œæ˜¯åˆ¤æ–­"æ˜¯å¦æœ‰æ˜ç¡®ä¸»é¢˜"

**è®¾è®¡åŸåˆ™**:
1. âœ… **æœ€å°å¤„ç†åŸåˆ™** - åªç§»é™¤æ˜ç¡®æ— æ„ä¹‰çš„è¯
2. âœ… **æ™ºèƒ½æ¨æ–­åŸåˆ™** - æ²¡æœ‰æ˜ç¡®ä¸»é¢˜æ—¶ä»ä¸Šä¸‹æ–‡æ¨æ–­
3. âœ… **é¿å…ç¡¬ç¼–ç åŸåˆ™** - ä¸ç»´æŠ¤æ— æ•ˆè¯é»‘åå•

**Topic æå–ç­–ç•¥**:
```python
# âœ… æ™ºèƒ½å¤„ç†
cleaned = re.sub(r'\d+\s*[ä¸ªé“å¼ ä»½]', '', cleaned)  # åªåˆ é™¤çº¯æ•°é‡
# "ç»™æˆ‘5é“é¢˜" â†’ "" â†’ topic=None â†’ fallback âœ…
# "ç‰›é¡¿ç¬¬äºŒå®šå¾‹" â†’ "ç‰›é¡¿ç¬¬äºŒå®šå¾‹" (ä¿ç•™æœ‰æ„ä¹‰çš„æ•°å­—) âœ…
# "äºŒæˆ˜å†å²" â†’ "äºŒæˆ˜å†å²" (ä¿ç•™) âœ…

if len(cleaned) >= 3:
    return cleaned  # æ˜ç¡®ä¸»é¢˜
return None  # è‡ªåŠ¨fallbackåˆ°current_topic
```

**ä¼˜åŠ¿å¯¹æ¯”**:

| æŒ‡æ ‡ | ç¡¬ç¼–ç æ–¹æ¡ˆ | æ™ºèƒ½æ¨æ–­æ–¹æ¡ˆ |
|------|-----------|------------|
| Token æ¶ˆè€— | 0 | 0 âœ… |
| è¦†ç›–ç‡ | ~60% âŒ | 100% âœ… |
| ç»´æŠ¤æˆæœ¬ | é«˜ âŒ | é›¶ âœ… |
| ç¬¦åˆ Agent ç†å¿µ | âŒ | âœ… |

---

### 3.5 Artifact History æ¶æ„

**ç›®æ ‡**: æ”¯æŒå¤šè½®ã€é•¿èŒƒå›´çš„ä¸Šä¸‹æ–‡å¼•ç”¨

**æ•°æ®ç»“æ„**:
```python
class ArtifactRecord(BaseModel):
    artifact_id: str          # "art_20250118_001"
    turn_number: int          # ç¬¬å‡ è½®å¯¹è¯
    timestamp: datetime       # ç”Ÿæˆæ—¶é—´
    artifact_type: str        # "quiz_set", "explanation"
    topic: str                # "äºŒæˆ˜å†å²"
    summary: str              # "ç”Ÿæˆäº†5é“äºŒæˆ˜é€‰æ‹©é¢˜"
    content: Dict[str, Any]   # å®Œæ•´å†…å®¹

class SessionContext(BaseModel):
    artifact_history: List[ArtifactRecord]  # æ‰€æœ‰artifact
    last_artifact_id: Optional[str]         # æŒ‡å‘æœ€æ–°çš„ID
    
    @property
    def last_artifact_content(self):  # å‘åå…¼å®¹
        return self.artifact_history[-1].content if self.artifact_history else None
```

**å­˜å‚¨ä¼˜åŒ–**:
- âŒ ä¹‹å‰: `last_artifact_content` å†—ä½™å­˜å‚¨å®Œæ•´å†…å®¹
- âœ… ç°åœ¨: åªå­˜å‚¨ `last_artifact_id`ï¼Œé€šè¿‡ `@property` åŠ¨æ€è·å–
- **æ•ˆæœ**: èŠ‚çœ 50% å­˜å‚¨ç©ºé—´

**å¼•ç”¨èƒ½åŠ›**:
```python
# æ”¯æŒçš„å¼•ç”¨ç±»å‹
"è§£é‡Šä¸€ä¸‹ç¬¬ä¸€é“é¢˜"        â†’ reference_type="question", index=0
"æ ¹æ®ç¬¬äºŒä¸ªä¾‹å­å‡ºé¢˜"      â†’ reference_type="example", index=1
"åŸºäºè¿™äº›ä¾‹å­ç”Ÿæˆé—ªå¡"    â†’ reference_type="examples", index=all
"æ ¹æ®åˆšæ‰åŒ—æå†°å·çš„é‚£ä¸ª"   â†’ reference_type="description", keyword="åŒ—æå†°å·"
```

---

### 3.6 ä¸Šä¸‹æ–‡å¼•ç”¨ä¼˜åŒ–

**ä¸¤å±‚å¤„ç†æœºåˆ¶**:

**Layer 1: è§„åˆ™å¼•æ“**
```python
# æ£€æµ‹æ˜ç¡®çš„ä¸Šä¸‹æ–‡å¼•ç”¨
context_keywords = ["ç¬¬ä¸€é“", "ç¬¬äºŒä¸ª", "è¿™é“", "è¿™äº›"]
if any(kw in message for kw in context_keywords):
    return {"use_last_artifact": True}
```

**Layer 2: LLM è¯­ä¹‰ç†è§£**
```python
# å¤æ‚å¼•ç”¨äº¤ç»™ LLM
"æ ¹æ®åˆšæ‰åŒ—æå†°å·èåŒ–çš„é‚£ä¸ªä¾‹å­" 
â†’ LLM æå–: {
    "reference_type": "example",
    "reference_description": "åŒ—æå†°å·èåŒ–"
}
â†’ Orchestrator è¯­ä¹‰æœç´¢ artifact_history
```

**Token æ¶ˆè€—**:
- è§„åˆ™å¼•æ“: 0 tokens (70% æƒ…å†µ)
- LLM fallback: ~1,500 tokens (30% æƒ…å†µ)

---

### 3.7 å­˜å‚¨ä¼˜åŒ–

**æœ¬åœ°æ–‡ä»¶æŒä¹…åŒ–**:
```bash
backend/memory_storage/
â”œâ”€â”€ user_demo-user.json          # UserLearningProfile
â””â”€â”€ session_demo-session.json    # SessionContext
```

**Datetime åºåˆ—åŒ–ä¿®å¤**:
```python
def convert_datetime(obj):
    """é€’å½’è½¬æ¢æ‰€æœ‰ datetime ä¸º ISO æ ¼å¼å­—ç¬¦ä¸²"""
    if isinstance(obj, datetime):
        return obj.isoformat()
    elif isinstance(obj, dict):
        return {k: convert_datetime(v) for k, v in obj.items()}
    elif isinstance(obj, list):
        return [convert_datetime(item) for item in obj]
    return obj
```

**ç‰¹æ€§**:
- âœ… è‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ° JSON
- âœ… æ”¯æŒæµè§ˆå™¨åˆ·æ–°åæ¢å¤
- âœ… æ–¹ä¾¿è°ƒè¯•å’Œæ£€æŸ¥
- ğŸ”„ è®¡åˆ’è¿ç§»åˆ° SQLite (V2)

---

### 3.8 æ¾„æ¸…æœºåˆ¶ï¼ˆClarificationï¼‰

**è®¾è®¡åŸåˆ™**: å½“ç³»ç»Ÿä¸ç¡®å®šæ—¶ï¼Œä¸»åŠ¨è¯¢é—®ç”¨æˆ·è€Œä¸æ˜¯çŒœæµ‹ âœ…

**è§¦å‘æ¡ä»¶**:
```python
# éœ€è¦æ¾„æ¸…çš„ Intent
needs_clarification_intents = [
    "notes", "quiz_request", "flashcard_request", 
    "explain_request", "mindmap", "learning_bundle"
]

# è§¦å‘é€»è¾‘
if intent in needs_clarification_intents:
    if topic is None and len(artifact_history) >= 1:  # âœ… å·²ä¿®å¤ï¼š>= 1
        return clarification_response
```

**å®ç°çŠ¶æ€**: âœ… **å·²å®Œæˆï¼ˆ0 token æ¶ˆè€—ï¼‰**

**åŠŸèƒ½**:
1. **Onboardingï¼ˆé¦–æ¬¡è®¿é—®ï¼‰**:
   - æ£€æµ‹: `len(artifact_history) == 0` ä¸”ç”¨æˆ·æ²¡æœ‰æ˜ç¡®ä¸»é¢˜
   - æ˜¾ç¤º: æ¬¢è¿å¡ç‰‡ + 5å¤§ç±»æ¨èä¸»é¢˜ï¼ˆç‰©ç†ã€æ•°å­¦ã€å†å²ã€ç”Ÿç‰©ã€è®¡ç®—æœºï¼‰
   - Token: 0ï¼ˆçº¯ä»£ç é€»è¾‘ï¼‰

2. **Multi-Topic Clarificationï¼ˆå¤šä¸»é¢˜æ¾„æ¸…ï¼‰**:
   - æ£€æµ‹: `topic is None` ä¸” `len(learned_topics) >= 1`
   - æ˜¾ç¤º: å¯ç‚¹å‡»çš„ä¸»é¢˜æŒ‰é’®ï¼ˆä» `artifact_history` æå–ï¼‰
   - Token: 0ï¼ˆçº¯ä»£ç é€»è¾‘ï¼‰

**ç¤ºä¾‹**:
```
ğŸ‘¤: åšç¬”è®°
ğŸ¤–: æ‚¨æƒ³å¯¹å“ªä¸ªä¸»é¢˜åšç¬”è®°å‘¢ï¼Ÿ
    [æœºå™¨å­¦ä¹ ] [ç‰›é¡¿å®šå¾‹] [å…‰åˆä½œç”¨]

ğŸ‘¤: å‡ºé¢˜ç›®ï¼ˆé¦–æ¬¡è®¿é—®ï¼‰
ğŸ¤–: ğŸ‘‹ æ¬¢è¿ä½¿ç”¨ StudyX Agentï¼
    æˆ‘æ³¨æ„åˆ°æ‚¨è¿˜æ²¡æœ‰å¼€å§‹å­¦ä¹ ä»»ä½•ä¸»é¢˜ã€‚
    
    ç‰©ç†: [ç‰›é¡¿å®šå¾‹] [å…‰å­¦] [ç”µç£å­¦] ...
    æ•°å­¦: [å¾®ç§¯åˆ†] [çº¿æ€§ä»£æ•°] ...
```

**Bug ä¿®å¤è®°å½•**:

1. **Topic æå–ä¼˜åŒ–** (2024-11-18):
   ```python
   # âŒ ä¿®å¤å‰
   filler_words = ["ç»™æˆ‘", "å¸®æˆ‘", ...]  # ç¼ºå°‘"åš"ã€"å‡º"ã€"çš„"
   
   # âœ… ä¿®å¤å
   filler_words = ["ç»™æˆ‘", "å¸®æˆ‘", ..., "åš", "å‡º", "çš„"]
   intent_keywords = [..., "é¢˜ç›®", "é¢˜", ...]  # æ·»åŠ "é¢˜ç›®"
   ```
   - ä¿®å¤: "åšç‰›é¡¿ç¬¬äºŒå®šå¾‹çš„ç¬”è®°" â†’ topic: "ç‰›é¡¿ç¬¬äºŒå®šå¾‹" âœ…
   - ä¿®å¤: "å‡ºé¢˜ç›®" â†’ topic: None âœ…ï¼ˆè§¦å‘ Clarificationï¼‰

2. **Clarification è§¦å‘æ¡ä»¶æ”¾å®½** (2024-11-18):
   ```python
   # âŒ ä¿®å¤å‰: åªæœ‰ > 1 ä¸ªä¸»é¢˜æ—¶æ‰è§¦å‘
   if len(learned_topics) > 1:
       return clarification_response
   
   # âœ… ä¿®å¤å: >= 1 å³å¯è§¦å‘
   if len(learned_topics) >= 1:
       return clarification_response
   ```
   - ä¿®å¤: ç”¨æˆ·å­¦ä¹ äº† 3 æ¬¡"æœºå™¨å­¦ä¹ "ï¼ˆå»é‡å 1 ä¸ªï¼‰ï¼Œè¯´"åšç¬”è®°"æ—¶ä¼šè§¦å‘æ¾„æ¸… âœ…

**è®¾è®¡å“²å­¦**:
- âœ… **è§„åˆ™å¼•æ“ä¿æŒç®€å•**: åªå¤„ç†æ˜ç¡®çš„æ­£é¢è¯·æ±‚
- âœ… **ä¸å†™æ­»å¦å®š/æŠ±æ€¨æ£€æµ‹**: é¿å…è¯¯åˆ¤å’Œç»´æŠ¤æˆæœ¬
- âœ… **äº¤ç»™ LLM å¤„ç†è¾¹ç¼˜ case**: è§„åˆ™å¼•æ“å¤±è´¥ â†’ LLM fallback

---

## 4. å‰ç«¯äº¤äº’ç‰¹æ€§

### 4.1 Notebook é£æ ¼ç¬”è®° UI

**ç‰¹æ€§**:
- å¡ç‰‡å¼ç« èŠ‚å±•ç¤º
- æ¸å˜è‰²æ ‡é¢˜
- å¯ç¼–è¾‘æ–‡æœ¬å­—æ®µ
- ç¼–è¾‘/ä¿å­˜/å–æ¶ˆæŒ‰é’®
- æ·»åŠ /åˆ é™¤è¦ç‚¹

**äº¤äº’**:
```javascript
- ç‚¹å‡» "ç¼–è¾‘" â†’ è¿›å…¥ç¼–è¾‘æ¨¡å¼
- ä¿®æ”¹å†…å®¹ â†’ å®æ—¶é¢„è§ˆ
- ç‚¹å‡» "ä¿å­˜" â†’ ä¿å­˜åˆ°åç«¯ï¼ˆè®¡åˆ’ä¸­ï¼‰
- ç‚¹å‡» "+" â†’ æ·»åŠ æ–°è¦ç‚¹
- ç‚¹å‡» "Ã—" â†’ åˆ é™¤è¦ç‚¹
```

---

### 4.2 æ€ç»´å¯¼å›¾æ¸²æŸ“

**åº“**: Mind Elixir (IIFEç‰ˆæœ¬)

**ç‰¹æ€§**:
- äº¤äº’å¼èŠ‚ç‚¹å±•å¼€/æŠ˜å 
- è‡ªåŠ¨å¸ƒå±€
- ä¸»é¢˜æ ·å¼
- å“åº”å¼è®¾è®¡

---

### 4.3 æ·±è‰²æ¨¡å¼

**æ”¯æŒ**:
- è‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿåå¥½
- æ‰‹åŠ¨åˆ‡æ¢æŒ‰é’®
- Tailwind CSS darkæ¨¡å¼
- æ‰€æœ‰ç»„ä»¶é€‚é…

---

## 5. æ•°æ®å­˜å‚¨

### 5.1 å½“å‰å®ç°

**å­˜å‚¨æ–¹å¼**: å†…å­˜ + æœ¬åœ°JSONæ–‡ä»¶

**æ–‡ä»¶ä½ç½®**:
```
backend/memory_storage/
â”œâ”€â”€ profile_demo-user.json      # ç”¨æˆ·ç”»åƒ
â”œâ”€â”€ session_demo-session.json   # ä¼šè¯ä¸Šä¸‹æ–‡
â””â”€â”€ README.md                    # ä½¿ç”¨è¯´æ˜
```

**æ–‡ä»¶æ ¼å¼**:
```json
{
  "session_id": "demo-session",
  "current_topic": "äºŒæˆ˜å†å²çš„",
  "last_artifact_content": {
    "questions": [...]
  },
  "_last_updated": "2025-11-18T16:30:00"
}
```

### 5.2 æŸ¥çœ‹æ–¹æ³•

```bash
# å®æ—¶ç›‘æ§
watch -n 1 "cat backend/memory_storage/session_demo-session.json | python3 -m json.tool"

# æŸ¥çœ‹ç‰¹å®šå†…å®¹
cat backend/memory_storage/session_demo-session.json | jq '.last_artifact_content.questions[0]'
```

### 5.3 V2 è®¡åˆ’

- âœ… SQLite æŒä¹…åŒ–
- âœ… S3 äº‘å­˜å‚¨æ”¯æŒ
- âœ… ç´¢å¼•å’ŒæŸ¥è¯¢ä¼˜åŒ–
- âœ… è‡ªåŠ¨å¤‡ä»½

---

## 6. æ‰©å±•æ€§

### 6.1 æ·»åŠ æ–°æŠ€èƒ½

**æ­¥éª¤**:
1. åˆ›å»º YAML é…ç½®: `backend/skills_config/new_skill.yaml`
2. åˆ›å»º Prompt: `backend/app/prompts/new_skill.txt`
3. æ·»åŠ intent_tagsåˆ°YAML
4. ï¼ˆå¯é€‰ï¼‰æ·»åŠ å‰ç«¯æ¸²æŸ“å‡½æ•°

**YAMLç¤ºä¾‹**:
```yaml
id: "new_skill"
display_name: "æ–°æŠ€èƒ½"
version: "1.0.0"
intent_tags: ["new", "skill_request"]
input_schema:
  type: "object"
  properties:
    topic:
      type: "string"
output_schema:
  type: "object"
  properties:
    result:
      type: "string"
```

---

### 6.2 è‡ªå®šä¹‰è§„åˆ™å¼•æ“

**ä½ç½®**: `backend/app/core/rule_based_classifier.py`

**æ·»åŠ æ–°è§„åˆ™**:
```python
intent_keywords = {
    "new_intent": {
        "keywords": ["å…³é”®è¯1", "å…³é”®è¯2"],
        "intent": "new_intent",
        "confidence": 0.95
    }
}
```

---

## 7. æœªæ¥è§„åˆ’

### V2 ç‰¹æ€§ (è®¡åˆ’ä¸­)

#### åç«¯ä¼˜åŒ–
- âœ… **KV Cacheä¼˜åŒ–** - ç¼“å­˜å¸¸ç”¨å¯¹è¯context
- âœ… **æ–‡ä»¶ç³»ç»Ÿä½œä¸ºå¤–éƒ¨è®°å¿†** - çŸ¥è¯†åº“é›†æˆ
- âœ… **å¯æ¢å¤å‹ç¼©** - é•¿å¯¹è¯è®°å¿†å‹ç¼©
- âœ… **ä¿ç•™é”™è¯¯å°è¯•** - å­¦ä¹ å¤±è´¥æ¡ˆä¾‹
- âœ… **Prefill Guidance** - å¼•å¯¼å¼ç”Ÿæˆ
- âœ… **åŠ¨æ€Planç®¡ç†** - å¤šæ­¥éª¤ä»»åŠ¡è§„åˆ’
- âœ… **Goal Driftä¿æŠ¤** - é˜²æ­¢ä»»åŠ¡åç¦»

#### å‰ç«¯å¢å¼º
- ğŸ”„ **Memory å†å²è®°å½•æµè§ˆå™¨** - Sidebar ä¸­æŸ¥çœ‹æ‰€æœ‰å†å²å­¦ä¹ è®°å½•
  - **åŠŸèƒ½**: åœ¨ Sidebar æ·»åŠ  "Learning History" å…¥å£
  - **å±•ç¤º**: ä»¥æ—¶é—´çº¿å½¢å¼å±•ç¤ºæ‰€æœ‰ artifact_history
    - æŒ‰æ—¥æœŸåˆ†ç»„ï¼ˆä»Šå¤©ã€æ˜¨å¤©ã€æœ¬å‘¨ã€æ›´æ—©ï¼‰
    - æ˜¾ç¤ºç¼©ç•¥ä¿¡æ¯ï¼ˆä¸»é¢˜ã€ç±»å‹ã€æ—¶é—´ï¼‰
    - æ”¯æŒæœç´¢å’Œç­›é€‰ï¼ˆæŒ‰ä¸»é¢˜ã€ç±»å‹ã€æ—¥æœŸï¼‰
  - **äº¤äº’**: ç‚¹å‡»ä»»æ„å†å²è®°å½•
    - åœ¨ Chat ç•Œé¢ä¸­å›æº¯æ˜¾ç¤ºè¯¥ artifact çš„å®Œæ•´å†…å®¹
    - æ”¯æŒç»§ç»­åŸºäºè¯¥ artifact æé—®ï¼ˆ"å†å‡º3é“ç±»ä¼¼çš„é¢˜"ï¼‰
    - æ”¯æŒåˆ é™¤/æ ‡è®°æ”¶è—
  - **UI è®¾è®¡**:
    ```
    Sidebar:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ğŸ“š Learning History     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ ğŸ” Search...            â”‚
    â”‚                         â”‚
    â”‚ ğŸ“… ä»Šå¤©                 â”‚
    â”‚  â”œâ”€ ğŸ“ äºŒæˆ˜å†å²ç¬”è®°      â”‚
    â”‚  â”‚   10:30 AM          â”‚
    â”‚  â””â”€ â“ å…‰åˆä½œç”¨é¢˜ç›® (5)  â”‚
    â”‚      09:15 AM          â”‚
    â”‚                         â”‚
    â”‚ ğŸ“… æ˜¨å¤©                 â”‚
    â”‚  â”œâ”€ ğŸ´ ç‰›é¡¿å®šå¾‹é—ªå¡ (10) â”‚
    â”‚  â””â”€ ğŸ—ºï¸ å¾®ç§¯åˆ†æ€ç»´å¯¼å›¾    â”‚
    â”‚                         â”‚
    â”‚ ğŸ”½ æœ¬å‘¨                 â”‚
    â”‚ ğŸ”½ æ›´æ—©                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    ç‚¹å‡»å â†’ Chat ç•Œé¢:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ğŸ’¬ Chat                 â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ [å›æº¯] 2024-11-18 10:30 â”‚
    â”‚                         â”‚
    â”‚ ğŸ“ äºŒæˆ˜å†å²ç¬”è®°          â”‚
    â”‚                         â”‚
    â”‚ [å®Œæ•´å†…å®¹å±•ç¤º...]        â”‚
    â”‚                         â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚ â”‚ åŸºäºæ­¤å†…å®¹ç»§ç»­å¯¹è¯   â”‚ â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    ```
  - **æŠ€æœ¯æ–¹æ¡ˆ**:
    - å‰ç«¯: æ–°å¢ `HistorySidebar.tsx` ç»„ä»¶
    - API: `GET /api/sessions/{session_id}/artifacts`
      - æ”¯æŒåˆ†é¡µã€ç­›é€‰ã€æœç´¢
    - çŠ¶æ€ç®¡ç†: ç¼“å­˜å·²åŠ è½½çš„å†å²è®°å½•
    - æ€§èƒ½ä¼˜åŒ–: è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤§é‡å†å²è®°å½•ï¼‰

### V3 ç‰¹æ€§ (è§„åˆ’ä¸­)

- å¤šæ¨¡æ€æ”¯æŒï¼ˆå›¾ç‰‡ã€éŸ³é¢‘ï¼‰
- å®æ—¶åä½œå­¦ä¹ 
- è‡ªé€‚åº”éš¾åº¦è°ƒæ•´
- å­¦ä¹ è·¯å¾„æ¨è
- ç¤¾åŒºçŸ¥è¯†åº“

---

## 8. Phase 4 æ¶æ„å±•æœ›ï¼šSkill Registry é©±åŠ¨

### 8.1 è®¾è®¡ç›®æ ‡

**æ ¸å¿ƒç†å¿µ**: Intent ä¸å†ç”¨ Prompt è¯†åˆ« â†’ æ”¹ä¸º Skill Registry åŒ¹é…ï¼ˆ0 tokenï¼‰

**ä¼˜åŒ–ç›®æ ‡**:
- âœ… Intent Router Token æ¶ˆè€—: **4,500 â†’ 0** (100% èŠ‚çœ)
- âœ… å“åº”æ—¶é—´: **<0.001s** (çº¯ä»£ç åŒ¹é…)
- âœ… æ¶æ„ç®€åŒ–: ç§»é™¤ LLM ä¾èµ–ï¼ˆIntent Routerï¼‰
- âœ… å¯æ‰©å±•æ€§: æ·»åŠ æ–° Skill åªéœ€æ–°å¢ skill.md

---

### 8.2 æ¶æ„å¯¹æ¯”

#### Phase 3 (å½“å‰)

```
User Message
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Intent Router                       â”‚
â”‚ 1. Rule Engine (70%, 0 tokens) âœ…   â”‚
â”‚ 2. LLM Fallback (30%, ~1,500) âš ï¸   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Skill Orchestrator â†’ Skill Execution

Token: 4,500 tokens / 10è½®å¯¹è¯
```

**é—®é¢˜**:
- âŒ 30% è¯·æ±‚ä»éœ€ LLM
- âŒ Skill å®šä¹‰åˆ†æ•£ï¼ˆYAML + Promptï¼‰
- âŒ Intent Router Prompt åŒ…å« Skill ä¿¡æ¯ï¼ˆå†—ä½™ï¼‰

#### Phase 4 (æœªæ¥)

```
User Message
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Skill Registry Matcher              â”‚
â”‚ (100%, 0 tokens) âœ…                  â”‚
â”‚                                     â”‚
â”‚ 1. Load skill.md                   â”‚
â”‚ 2. Keyword matching                â”‚
â”‚ 3. Parameter extraction            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Skill Instance â†’ Skill Execution

Token: 0 tokens / 10è½®å¯¹è¯ ğŸ‰
```

**ä¼˜åŠ¿**:
- âœ… 100% æ„å›¾è¯†åˆ« 0 token
- âœ… Skill å®šä¹‰ç»Ÿä¸€ï¼ˆskill.mdï¼‰
- âœ… Prompt åªç”¨äºæŠ€èƒ½æ‰§è¡Œ
- âœ… æ˜“äºæ‰©å±•

---

### 8.3 æ ¸å¿ƒç»„ä»¶

#### Skill Metadata (skill.md)

**æ–‡ä»¶ç»“æ„**:
```
backend/skills/
â”œâ”€â”€ quiz_skill/
â”‚   â”œâ”€â”€ skill.md     â† æŠ€èƒ½å®šä¹‰ï¼ˆç»“æ„åŒ–ï¼‰
â”‚   â””â”€â”€ prompt.txt   â† æ‰§è¡Œæç¤ºï¼ˆä»…ç”¨äº LLMï¼‰
â”œâ”€â”€ explain_skill/
â”‚   â”œâ”€â”€ skill.md
â”‚   â””â”€â”€ prompt.txt
â””â”€â”€ ...
```

**skill.md æ ¼å¼**:
```markdown
# Quiz Skill - ç»ƒä¹ é¢˜ç”Ÿæˆ

## Metadata
- **ID**: quiz_skill
- **Display Name**: ç»ƒä¹ é¢˜ç”Ÿæˆ
- **Version**: 1.0.0

## Intent Triggers
### Primary Keywords
- é¢˜, é¢˜ç›®, ç»ƒä¹ , quiz, test

### Quantity Patterns
- \d+é“é¢˜ â†’ quantity
- \d+ä¸ªé—®é¢˜ â†’ quantity

### Topic Patterns
- {quantity}é“{topic}çš„é¢˜ â†’ topic
- å…³äº{topic}çš„ç»ƒä¹  â†’ topic

## Input Schema
{
  "topic": "string (required)",
  "quantity": "integer (default: 5)",
  "difficulty": "enum[easy, medium, hard]",
  "source_content": "object (optional)"
}

## Output Schema
{
  "quiz_set_id": "string",
  "questions": [...]
}

## Examples
- "ç»™æˆ‘5é“äºŒæˆ˜å†å²çš„é¢˜" â†’ quiz_skill(topic="äºŒæˆ˜å†å²", quantity=5)
- "å‡ºé¢˜ç›®" â†’ quiz_skill(topic=None) â†’ Clarification
```

#### Skill Registry

**åŠŸèƒ½**:
```python
class SkillRegistry:
    def match_message(self, message: str) -> SkillMatch:
        """
        åŒ¹é…ç”¨æˆ·æ¶ˆæ¯åˆ°æŠ€èƒ½ (0 tokens)
        
        æµç¨‹:
        1. åŠ è½½æ‰€æœ‰ skill.md
        2. å…³é”®è¯åŒ¹é…
        3. å‚æ•°æå–ï¼ˆæ­£åˆ™ï¼‰
        4. è®¡ç®—ç½®ä¿¡åº¦
        
        è¿”å›:
        - skill_id: åŒ¹é…çš„æŠ€èƒ½
        - confidence: åŒ¹é…ç½®ä¿¡åº¦
        - parameters: æå–çš„å‚æ•°
        """
```

#### Intent Router (ç®€åŒ–ç‰ˆ)

**æ–°é€»è¾‘**:
```python
class IntentRouter:
    def parse(self, message: str) -> IntentResult:
        # 1. Skill Registry åŒ¹é… (0 tokens)
        match = self.skill_registry.match_message(message)
        
        if match and match.confidence >= 0.8:
            return IntentResult(
                intent=match.skill_id,
                topic=match.parameters.get("topic"),
                parameters=match.parameters
            )
        
        # 2. Fallback: other intent (ä»ç„¶ 0 tokens)
        return IntentResult(intent="other", topic=None)
```

**ç§»é™¤**:
- âŒ gemini_client
- âŒ rule_based_classifier
- âŒ LLM fallback é€»è¾‘
- âŒ Prompt template

---

### 8.4 æ€§èƒ½é¢„æœŸ

#### Token æ¶ˆè€—ï¼ˆ10è½®å¯¹è¯ï¼‰

| æ¶æ„ | Intent Router | Skill Execution | æ€»è®¡ | ä¼˜åŒ– |
|------|--------------|----------------|------|------|
| Phase 1 (çº¯LLM) | 31,320 | ~60,000 | 91,320 | - |
| Phase 3 (è§„åˆ™å¼•æ“) | 4,500 | ~60,000 | 64,500 | -29% |
| **Phase 4 (Skill Registry)** | **0** | **~60,000** | **~60,000** | **-34%** âœ… |

**Intent Router Token èŠ‚çœ**:
- Phase 3 â†’ Phase 4: 4,500 â†’ 0 (**-100%**)

#### å“åº”æ—¶é—´

| æ¶æ„ | Intent Router | ä¼˜åŒ– |
|------|--------------|------|
| Phase 1 (çº¯LLM) | ~2.0s | - |
| Phase 3 (è§„åˆ™å¼•æ“) | <0.01s (70%) / ~1.6s (30%) | -92% |
| **Phase 4 (Skill Registry)** | **<0.001s (100%)** | **-99.95%** âœ… |

#### æ¶æ„å¤æ‚åº¦

| æŒ‡æ ‡ | Phase 3 | Phase 4 | ä¼˜åŒ– |
|------|---------|---------|------|
| Intent Router LOC | ~500 è¡Œ | **~200 è¡Œ** | -60% âœ… |
| ä¾èµ– LLM | æ˜¯ (30%) | **å¦** | âœ… |
| Skill å®šä¹‰ | YAML + Prompt | **skill.md** | âœ… |
| å¯æ‰©å±•æ€§ | ä¸­ç­‰ | **é«˜** | âœ… |
| ç»´æŠ¤æˆæœ¬ | ä¸­ç­‰ | **ä½** | âœ… |

---

### 8.5 å®æ–½è®¡åˆ’

#### Phase 1: åˆ›å»º skill.md (2-3å°æ—¶)

**ä»»åŠ¡**:
- ä¸º 6 ä¸ªæŠ€èƒ½åˆ›å»º skill.md
- å®šä¹‰ Intent Triggersã€Input/Output Schema
- è¿ç§»ç°æœ‰ YAML é…ç½®

**æ–‡ä»¶**:
```
backend/skills/
â”œâ”€â”€ quiz_skill/skill.md
â”œâ”€â”€ explain_skill/skill.md
â”œâ”€â”€ flashcard_skill/skill.md
â”œâ”€â”€ notes_skill/skill.md
â”œâ”€â”€ mindmap_skill/skill.md
â””â”€â”€ learning_bundle_skill/skill.md
```

#### Phase 2: å¢å¼º Skill Registry (1-2å°æ—¶)

**åŠŸèƒ½**:
- `_load_all_skills()`: åŠ è½½æ‰€æœ‰ skill.md
- `_parse_skill_md()`: è§£æ Markdown æ ¼å¼
- `match_message()`: åŒ¹é…ç”¨æˆ·æ¶ˆæ¯ï¼ˆ0 tokensï¼‰
- `_calculate_confidence()`: è®¡ç®—åŒ¹é…ç½®ä¿¡åº¦

#### Phase 3: ç®€åŒ– Intent Router (30åˆ†é’Ÿ)

**ç§»é™¤**:
- LLM fallback é€»è¾‘
- Prompt template åŠ è½½
- Gemini client ä¾èµ–

**ä¿ç•™**:
- `parse()` æ–¹æ³•ï¼ˆç®€åŒ–ä¸ºè°ƒç”¨ Skill Registryï¼‰
- IntentResult æ„å»º

#### Phase 4: æµ‹è¯•å’ŒéªŒè¯ (1å°æ—¶)

**æµ‹è¯•ç”¨ä¾‹**:
```python
# æ˜ç¡®è¯·æ±‚
assert match("ç»™æˆ‘5é“äºŒæˆ˜å†å²çš„é¢˜").skill_id == "quiz_skill"
assert match("ç»™æˆ‘5é“äºŒæˆ˜å†å²çš„é¢˜").parameters == {
    "topic": "äºŒæˆ˜å†å²",
    "quantity": 5
}

# æ— ä¸»é¢˜ï¼ˆè§¦å‘ Clarificationï¼‰
assert match("å‡ºé¢˜ç›®").parameters["topic"] is None

# ä¸Šä¸‹æ–‡å¼•ç”¨
assert match("è§£é‡Šä¸€ä¸‹ç¬¬ä¸€é“é¢˜").parameters == {
    "use_last_artifact": True,
    "reference_index": 0
}

# æœªåŒ¹é…
assert match("ä½ å¥½") is None  # Fallback to "other"
```

**æ€»æ—¶é—´**: 4-6 å°æ—¶

---

### 8.6 å…¼å®¹æ€§ç­–ç•¥

**æ¸è¿›å¼è¿ç§»**:
```python
class IntentRouter:
    def parse(self, message: str) -> IntentResult:
        # 1. ä¼˜å…ˆï¼šSkill Registry (0 tokens)
        match = self.skill_registry.match_message(message)
        if match and match.confidence >= 0.8:
            return self._build_result(match)
        
        # 2. Fallbackï¼šè§„åˆ™å¼•æ“ (Phase 3, 0 tokens)
        rule_result = self.rule_classifier.classify(message)
        if rule_result:
            return rule_result
        
        # 3. æœ€ç»ˆï¼šLLM (å¯é€‰ï¼Œé€æ­¥ç§»é™¤)
        # return self._llm_fallback(message)  # â† æœªæ¥ç§»é™¤
        
        # 4. é»˜è®¤ï¼šother intent
        return IntentResult(intent="other", topic=None)
```

**ä¼˜åŠ¿**:
- âœ… ä¸ç ´åç°æœ‰åŠŸèƒ½
- âœ… é€æ­¥æé«˜ Skill Registry åŒ¹é…ç‡
- âœ… æœ€ç»ˆå®Œå…¨ç§»é™¤ LLM ä¾èµ–

---

### 8.7 é¢„æœŸæ”¶ç›Š

#### Token æˆæœ¬

**10è½®å¯¹è¯**:
- Phase 3: 64,500 tokens (Intent: 4,500 + Skill: 60,000)
- Phase 4: **60,000 tokens** (Intent: 0 + Skill: 60,000)
- **èŠ‚çœ**: 4,500 tokens / 10è½® = **450 tokens/è½®**

**100è½®å¯¹è¯**:
- Phase 3: 645,000 tokens
- Phase 4: **600,000 tokens**
- **èŠ‚çœ**: 45,000 tokens (**$0.07 @ Gemini Flash ä»·æ ¼**)

#### å“åº”é€Ÿåº¦

- Intent Router: **<0.001s** (vs Phase 3 å¹³å‡ ~0.5s)
- æ€»å“åº”æ—¶é—´: **-10%** (å‡å°‘ 0.5s å»¶è¿Ÿ)

#### æ¶æ„è´¨é‡

- **ä»£ç é‡**: -60% (Intent Router)
- **ç»´æŠ¤æˆæœ¬**: -70% (æ— éœ€ç»´æŠ¤ LLM prompt)
- **æ‰©å±•æ€§**: +100% (æ·»åŠ æ–° Skill åªéœ€æ–°å¢ skill.md)
- **å¯æµ‹è¯•æ€§**: +100% (çº¯ä»£ç é€»è¾‘ï¼Œæ˜“æµ‹è¯•)

---

### 8.8 æŠ€æœ¯æŒ‘æˆ˜

#### æŒ‘æˆ˜ 1: å¤æ‚è¯­ä¹‰ç†è§£

**é—®é¢˜**: "æ ¹æ®åˆšæ‰åŒ—æå†°å·èåŒ–çš„é‚£ä¸ªä¾‹å­å‡º3é“é¢˜"
**ç°çŠ¶**: LLM ç†è§£å¤æ‚å¼•ç”¨
**æ–¹æ¡ˆ**: 
- Skill Registry è¯†åˆ« "å‡ºé¢˜" â†’ quiz_skill
- å‚æ•°æå–: "åŒ—æå†°å·èåŒ–" (å…³é”®è¯åŒ¹é…)
- ä¸Šä¸‹æ–‡ç®¡ç†: Orchestrator è´Ÿè´£ï¼ˆå·²æœ‰ï¼‰

#### æŒ‘æˆ˜ 2: æ¨¡ç³Šæ„å›¾

**é—®é¢˜**: "å¸®æˆ‘å­¦ä¹ ä¸€ä¸‹"
**ç°çŠ¶**: LLM æ¨æ–­ç”¨æˆ·åå¥½
**æ–¹æ¡ˆ**:
- Fallback åˆ° Clarificationï¼ˆå·²æœ‰ï¼‰
- å±•ç¤ºæ‰€æœ‰å¯ç”¨ Skills
- ç”¨æˆ·é€‰æ‹©åå†æ‰§è¡Œ

#### æŒ‘æˆ˜ 3: æ–°å¢ Skill

**é—®é¢˜**: å¦‚ä½•å¿«é€Ÿæ‰©å±•æ–°æŠ€èƒ½ï¼Ÿ
**æ–¹æ¡ˆ**:
- åˆ›å»º skill.mdï¼ˆ5-10åˆ†é’Ÿï¼‰
- Skill Registry è‡ªåŠ¨åŠ è½½
- æ— éœ€ä¿®æ”¹ Intent Router ä»£ç  âœ…

---

### 8.9 å®æ–½ä¼˜å…ˆçº§

| ä¼˜å…ˆçº§ | é˜¶æ®µ | æ—¶é—´ | æ”¶ç›Š | é£é™© |
|-------|------|------|------|------|
| ğŸ”´ é«˜ | Phase 1: åˆ›å»º skill.md | 2-3h | æ˜ç¡® Skill å®šä¹‰ | ä½ |
| ğŸ”´ é«˜ | Phase 2: å¢å¼º Skill Registry | 1-2h | 0 token åŒ¹é… | ä½ |
| ğŸŸ¡ ä¸­ | Phase 3: ç®€åŒ– Intent Router | 30min | ç§»é™¤ LLM | ä¸­ |
| ğŸŸ¢ ä½ | Phase 4: æµ‹è¯•éªŒè¯ | 1h | ç¡®ä¿æ­£ç¡®æ€§ | ä½ |

**æ€»æ—¶é—´**: 4-6 å°æ—¶
**é¢„æœŸå®Œæˆ**: V2.1 ç‰ˆæœ¬

---

## ğŸ“Š ç»Ÿè®¡æ•°æ®

### åŠŸèƒ½å®Œæˆåº¦

- **æ ¸å¿ƒæŠ€èƒ½**: 6/6 å®Œæˆ âœ…
  - æ¦‚å¿µè®²è§£ã€ç»ƒä¹ é¢˜ç”Ÿæˆã€æŠ½è®¤å¡ç”Ÿæˆã€æ€ç»´å¯¼å›¾ã€ç¬”è®°ç”Ÿæˆã€å­¦ä¹ åŒ…
- **æ™ºèƒ½Agentèƒ½åŠ›**: 100% å®Œæˆ âœ…
  - ä¸Šä¸‹æ–‡æ¨æ–­ã€æ„å›¾è¯†åˆ«ã€åå¥½å­¦ä¹ ã€å¤šæŠ€èƒ½ç¼–æ’
- **Phase 3 æ¶æ„ä¼˜åŒ–**: 100% å®Œæˆ âœ…
  - æ··åˆ Intent Routerï¼ˆè§„åˆ™å¼•æ“ + LLMï¼‰
  - Minimal Intent Routerï¼ˆç²¾ç®€ä¸Šä¸‹æ–‡ï¼‰
  - Token ä¼˜åŒ–ï¼ˆå¹³å‡èŠ‚çœ 85.6%ï¼‰
  - æ¾„æ¸…æœºåˆ¶ï¼ˆClarification + Onboardingï¼‰
  - Artifact Historyï¼ˆå¤šè½®å¼•ç”¨ï¼‰
  - æœ¬åœ°æŒä¹…åŒ–è°ƒè¯•ï¼ˆJSON è¾“å‡ºï¼‰
- **å‰ç«¯UI**: 100% å®Œæˆ âœ…
  - Notebook é£æ ¼ç¬”è®°ç¼–è¾‘å™¨
  - æ€ç»´å¯¼å›¾æ¸²æŸ“
  - Clarification/Onboarding å¡ç‰‡
  - æ·±è‰²æ¨¡å¼
- **æ•°æ®æŒä¹…åŒ–**: 80% å®Œæˆ
  - âœ… å†…å­˜ + æœ¬åœ° JSON æ–‡ä»¶
  - ğŸ”„ SQLite æŒä¹…åŒ–ï¼ˆV2 è§„åˆ’ï¼‰

### ä»£ç ç»Ÿè®¡

- **æ€»ä»£ç è¡Œæ•°**: ~15,000è¡Œ
- **Pythonåç«¯**: ~8,000è¡Œ
- **Frontend**: ~3,000è¡Œ
- **é…ç½®æ–‡ä»¶**: ~1,000è¡Œ
- **æ–‡æ¡£**: ~3,000è¡Œ

---

<div align="center">
  ğŸ“š æ›´å¤šä¿¡æ¯è¯·å‚è€ƒ <a href="README.md">README.md</a> å’Œ <a href="TESTING.md">TESTING.md</a>
</div>
